module.exports=function(a,b){"use strict";function c(a){if(a)for(var b=this.length=a.length,c=0;b>c;++c)this[c]=a[c];else this.length=0}function d(d,e,f){b.length||a(function(){for(var a=0;a<b.length;a+=3){var d=b[a],e=b[a+1],f=b[a+2],g=d[e?2:3];if("function"!=typeof g)d[e?0:1].apply(void 0,f);else try{var h=g.apply(void 0,f);h instanceof c?d[0].apply(void 0,h):d[0](h)}catch(i){d[1](i)}}b=[]}),b.push(d,e,f)}function e(a,b,c){if(a&&("object"==typeof a||"function"==typeof a)){try{var d=a.then}catch(e){return c(e),1}if("function"==typeof d){var f=0;try{d.call(a,function(){f++||b.apply(void 0,arguments)},function(){f++||c.apply(void 0,arguments)})}catch(e){f++||c(e)}return 1}}}function f(a,b){return function(c,e){return new h(function(f,g){d([f,g,c,e],a,b)})}}function g(a,b,d){function f(){for(var a=0,b=i.length;b>a;++a)try{i[a].cancel()}catch(c){}}function g(a,f){e(f,function(d){j[a]=arguments.length>1?new c(arguments):d,--h||b(j)},d)?(++h,i.push(f)):j[a]=f}if("object"!=typeof a||!("length"in a))return d(TypeError("not array"));for(var h=0,i=[],j=[],k=0,l=a.length;l>k;++k)g(k,a[k]);return l&&h?{cancel:f}:b(j)}function h(a){var b,c=this,j=[],k=function(a,b){for(var e=0;e<j.length;++e)d(j[e],b,a);c.then=f(b,a),j=0},l=0,m=function(a){l||(++l,a===i&&b&&b(),k(arguments,0))},n=function(a){if(a===c)throw TypeError();arguments.length>1?g(arguments,function(a){k(a,1)},m):e(a,n,m)||k(arguments,1)};if(this.then=function(a,b){return new h(function(d,e){return j.push([d,e,a,b]),{cancel:c.cancel}})},this.cancel=function(){return m(i),this},"function"==typeof a)try{var o=a(n,m);if("object"==typeof o){var p=o.cancel;"function"==typeof p&&(b=p)}}catch(q){m(q)}}c.prototype={push:function(a){this[this.length++]=a},concat:function(a){if(a instanceof c||a instanceof Array)for(var b=0,d=a.length;d>b;++b)this.push(a[b]);else this.push(a)}};var i="CANCEL";return h.prototype={cancel:function(){},"catch":function(a){return this.then(0,a)},"finally":function(a){return this.then(function(){return a(),new c(arguments)},function(b){throw a(),b})}},h.all=function(a){return new h(function(b,c){return g(a,b,c)})},h.race=function(a){return new h(function(b,c){if("object"!=typeof a||!1 in a)return c(TypeError("not array"));for(var d=[],f=function(){for(var a=0,b=d.length;b>a;++a)try{d[a].cancel()}catch(c){}},g=0,h=a.length;h>g;++g){var i=a[g];if(!e(i,b,c))return void b(a[g]);d.push(i)}return d.length?{cancel:f}:void(h||b())})},h.resolve=function(){var a=arguments;return new h(function(b,c){b.apply(null,a)})},h.reject=function(){var a=Object.create(h.prototype);return a.then=f(0,arguments),a},h.Arguments=c,h.CANCEL_REASON=i,h.concat=function(a){return h.all(a).then(function(a){for(var b=new c,d=0,e=a.length;e>d;++d)b.concat(a[d]);return b})},h}(process.nextTick,[]);